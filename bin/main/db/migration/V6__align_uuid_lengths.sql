-- V1_1__align_uuid_lengths.sql
-- Samakan panjang kolom FK agar cocok dengan PROFILE.id (VARCHAR2(36))
-- dan role_management.id (VARCHAR2(36))

-- 1) Drop dulu FK yang terdampak (wajib di Oracle sebelum MODIFY)
ALTER TABLE USER_AUTH        DROP CONSTRAINT FK_USER_AUTH_PROFILE;
ALTER TABLE USER_AUTH        DROP CONSTRAINT FK_USER_AUTH_ROLE;
ALTER TABLE ACCOUNT          DROP CONSTRAINT FK_ACCOUNT_USER;
ALTER TABLE TIME_DEPOSIT_ACCOUNT DROP CONSTRAINT FK_TDA_USER;
ALTER TABLE TRX_HISTORY      DROP CONSTRAINT FK_TRX_HISTORY_USER;
ALTER TABLE LIFEGOALS_ACCOUNT DROP CONSTRAINT FK_LIFEGOALS_ACCOUNT_PROFILE;
-- SPLIT_BILL_MEMBER tidak punya FK ke PROFILE; SPLIT_BILL punya FK ke PROFILE:
ALTER TABLE SPLIT_BILL       DROP CONSTRAINT FK_SPLIT_BILL_USER;

-- 2) Samakan panjang kolom
ALTER TABLE USER_AUTH            MODIFY (role_id   VARCHAR2(36));
ALTER TABLE ACCOUNT              MODIFY (user_id   VARCHAR2(36));
ALTER TABLE TIME_DEPOSIT_ACCOUNT MODIFY (user_id   VARCHAR2(36));
ALTER TABLE TRX_HISTORY          MODIFY (user_id   VARCHAR2(36));
ALTER TABLE LIFEGOALS_ACCOUNT    MODIFY (user_id   VARCHAR2(36));
ALTER TABLE SPLIT_BILL           MODIFY (user_id   VARCHAR2(36));
-- (PROFILE.id, role_management.id sudah 36, OTP_VERIFICATION.user_id sudah 36)

-- 3) Re-create FK dengan tipe yang sekarang sudah match
ALTER TABLE USER_AUTH
  ADD CONSTRAINT FK_USER_AUTH_PROFILE FOREIGN KEY (user_id) REFERENCES PROFILE(id);

ALTER TABLE USER_AUTH
  ADD CONSTRAINT FK_USER_AUTH_ROLE FOREIGN KEY (role_id) REFERENCES role_management(id);

ALTER TABLE ACCOUNT
  ADD CONSTRAINT FK_ACCOUNT_USER FOREIGN KEY (user_id) REFERENCES PROFILE(id);

ALTER TABLE TIME_DEPOSIT_ACCOUNT
  ADD CONSTRAINT FK_TDA_USER FOREIGN KEY (user_id) REFERENCES PROFILE(id);

ALTER TABLE TRX_HISTORY
  ADD CONSTRAINT FK_TRX_HISTORY_USER FOREIGN KEY (user_id) REFERENCES PROFILE(id);

ALTER TABLE LIFEGOALS_ACCOUNT
  ADD CONSTRAINT FK_LIFEGOALS_ACCOUNT_PROFILE FOREIGN KEY (user_id) REFERENCES PROFILE(id);

ALTER TABLE SPLIT_BILL
  ADD CONSTRAINT FK_SPLIT_BILL_USER FOREIGN KEY (user_id) REFERENCES PROFILE(id);
